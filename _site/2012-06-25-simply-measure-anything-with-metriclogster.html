<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Simply Measure Anything with MetricLogster&mdash;Mark Crossfield</title>
      <meta name="viewport" content="width=device-width">

      <!-- syntax highlighting CSS -->
      <link rel="stylesheet" href="/css/syntax.css">

      <!-- Custom CSS -->
      <link rel="stylesheet" href="/css/main.css">

      <!-- Responsive CSS -->
      <link rel="stylesheet" href="/css/responsive.css">

      <!-- Google Fonts -->
      <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>
      <link href='http://fonts.googleapis.com/css?family=Raleway:300,400,700' rel='stylesheet' type='text/css'>
      <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-352611-12', 'markcrossfield.co.uk');
      ga('require', 'linkid', 'linkid.js');
      ga('send', 'pageview');

    </script>
    <script type="text/javascript">
      var disqus_developer = 1;
    </script>
  </head>
  <body>
    <div class="site">
      <div class="sidebar" id="sidebar">
        <div class="header">
          <a href="/"><img id="logo" src="/images/logo.png" width="128" height="99"></a>
          <span class="tagline">Developer, engineer, trouble maker</span>
        </div>
        <div class="footer">
          <span id="footer-links">
            <a href="/about/" class="footer-link">About Mark</a> <span class="separator">&bull;</span>
            <a href="https://twitter.com/mrmanc" class="footer-link">@mrmanc</a> <span class="separator">&bull;</span>
            <a href="https://github.com/mrmanc" class="footer-link">GitHub</a>
          </span>
        </div>
        <div class="posts">
          <ul class="posts-list">
            
              <li class="post-link">
                <a class="post-title" href="/2014-05-01-devops-manchester-monitoring-graphite-and-friends.html">
                  <span class="post-date">01 May 2014</span>
                  DevOps Manchester—Graphite and Friends
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-04-07-quality-shell-scripting-static-analysis.html">
                  <span class="post-date">07 Apr 2014</span>
                  Static Analysis of Shell Scripts
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-28-bad-interpreter-use-svn-autoprops-to-stop-committing-windows-line-endings-in-shell-scripts.html">
                  <span class="post-date">28 Mar 2014</span>
                  Bad Interpreter—SVN autoprops save the day
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-27-bash-shell-unit-testing.html">
                  <span class="post-date">27 Mar 2014</span>
                  Test Driven Development in Bash
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-25-bash-dotfiles-bindle.html">
                  <span class="post-date">25 Mar 2014</span>
                  Take your scripts with you
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-17-using-os-x-at-work-behind-a-proxy.html">
                  <span class="post-date">17 Mar 2014</span>
                  Using OS X at work behind a proxy
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-16-free-hosting-with-github-pages.html">
                  <span class="post-date">16 Mar 2014</span>
                  Free hosting with Github Pages
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-02-16-thats-no-moon-visualising-go-delivery-pipelines-using-d3-js.html">
                  <span class="post-date">16 Feb 2014</span>
                  That’s no moon: Visualising Go Delivery Pipelines Using D3.js
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2013-05-22-saving-the-world-one-dashboard-at-a-time-using-task-scheduler-and-nircmd-and-powercfg.html">
                  <span class="post-date">22 May 2013</span>
                  Saving the world, one dashboard at a time
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2012-06-26-ascii-distribution-histogram-pivot-your-standard-out.html">
                  <span class="post-date">26 Jun 2012</span>
                  Ascii Distribution Histogram—pivot your standard out
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2012-06-25-simply-measure-anything-with-metriclogster.html">
                  <span class="post-date">25 Jun 2012</span>
                  Simply Measure Anything with MetricLogster
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2012-05-10-meet-graphite.html">
                  <span class="post-date">10 May 2012</span>
                  Meet Graphite
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2012-02-15-fast-feedback.html">
                  <span class="post-date">15 Feb 2012</span>
                  Fast Feedback
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2011-07-31-are-your-pairs-rotating-enough-generate-a-pairing-heat-map.html">
                  <span class="post-date">31 Jul 2011</span>
                  Are your pairs rotating enough? Generate a pairing heat map
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2011-07-30-automating-vuze-with-dropbox-in-os-x.html">
                  <span class="post-date">30 Jul 2011</span>
                  Automating Vuze with Dropbox (in OS X)
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2011-06-05-hello.html">
                  <span class="post-date">05 Jun 2011</span>
                  Hello!
                </a>
              </li>
            
          </ul>
        </div>
        <div class="footer">
          <p>Hosted on <a href="http://pages.github.com/">Github Pages</a> using <a href="http://jekyllrb.com/">Jekyll</a> and <a href="http://the-development.github.io/flex/">Flex</a>
        </div>
      </div>
      <div class="content" id="home">
          <div id="sidebar-button">
    <img src="/images/sidebar-button.png" width="32" height="32">
  </div>
  <div id="post-info">
    
    <div id="cover-photo-container">
      <img id="cover-photo" src="/images/ruler.jpg">
    </div>
    
    <div id="info-container">
      <h1 id="title">Simply Measure Anything with MetricLogster</h1>
      <span id="date">25 June 2012</a>
    </div>
  </div>

  <div class="post">
    <p>Okay, so my <a href="http://markisadeveloper.wordpress.com/2012/05/10/meet-graphite/">previous post</a> is a long overdue summary of how we are visualising application metrics using Graphite. We are writing custom Logster parsers which scan our log files and push interesting things into Graphite. This means that to get a new metric into Graphite we need to add it to our log files (unless it already exists), and adapt or create a python Logster parser to understand whatever we’ve logged. This parser then needs to be deployed to our server running logster and a graph built. The biggest blocker we’ve seen with this approach is the necessity for the engineer to understand how to write Python, where to find and test the Logster parsers, and how to deploy the parser to the Logster server. Personally, this means either doing the work myself or explaining the peculiarities of Python white space handling to yet another person. There must be a better way.</p>

<p>It has occurred to us to use StatsD to simplify this stuff by the way, but we’re not convinced it is designed to scale.</p>

<p>A couple of months ago I had the idea of creating a generalised parser to make this process easier. A little Googling discovered that, as usual, someone had already had a similar idea. Jeff Blaine had <a href="https://github.com/jblaine/logster/commit/a6a1da5a3a1ad527f3493cfe4b561893932207ec">committed</a> a MetricParser (as detailed in this <a href="http://www.kickflop.net/blog/2012/03/30/any-metric-graphing-with-graphite-and-syslog/">blog post</a>) which was intended to be used with syslog. This dealt with the use case of wanting to log counter type metrics, however we also find ourselves logging a lot of time based metrics which don’t lend themselves to being totalled up as a counter.</p>

<p>So in discussion with Jeff I have rewritten the MetricLogster to accept time based metrics, and modified the format slightly.</p>

<p>The upshot of this is that once you’ve got MetricLogster hitting your application’s log files, then creating a new metric in Graphite is as simple as creating a line of log, for example (using Log4J):</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">logger.info(&quot;METRIC_COUNT name=customer.checkout value=1&quot;);
</code></pre></div>
<p>Or, if you are logging a time, you can just do:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">logger.info(&quot;METRIC_TIME name=request_duration value=150ms&quot;);
</code></pre></div>
<p>Once you’ve got your application writing those statements, the MetricLogster parser will pick them up and understand what to push to Graphite. In the case of counts, you are only really interested in the total figure - how many customers checked out, how often a service failed etc. When you are logging times however it makes no sense to total them up; you want to know what some aggregate function returns for the set of times. Usually, you’re interested in the mean, median (if you’ve realised that the mean doesn’t tell you much), and possibly something like the interquartile range to tell you how distributed the values were.</p>

<p>So, what do you get for free? For the above, you would get:</p>

<ul>
<li>customer.checkout (as a total)</li>
<li>request_duration.mean</li>
<li>request_duration.median</li>
<li>request<em>duration.90th</em>percentile</li>
</ul>

<p>This is the purpose behind stating in the log file what sort of metric it is. Configuring what percentiles to record is just a matter of specifying them as parameters in the call to Logster.</p>

<p>But wait: this doesn’t just work for Log4J! If you can adapt your log format, you can use this for anything! All you have to do is conform to the syntax and the parser will do the rest. And Jeff’s idea of hooking this up to your syslog server is very smart - that way rather than having to wire up the parser and your log file each time you build a new app, you can just hook up one syslog server (or even a cluster) and get all the benefit of UDP fire and forget integration with your Graphite server, via a UDP &gt; Syslog &gt; log file &gt; Logster &gt; Graphite route.</p>

<p>I’m still waiting for my pull request to get processed, So in the meantime:</p>

<p><strong><a href="https://github.com/mrmanc/logster/blob/master/parsers/MetricLogster.py">look here for the new MetricLogster</a></strong></p>

<p>(and you’ll need <a href="https://github.com/mrmanc/logster/blob/master/parsers/stats_helper.py">stats_helper</a>)</p>

<p>Set it up, tell people about it and see what happens.</p>

<p>One line change == metrics in Graphite == win!</p>

  </div>
  <div class="colophon">
    <p>
      <span id="pub-date">Published on 25 June 2012</span> <span class="separator">&bull;</span> <a href="/2012-06-25-simply-measure-anything-with-metriclogster.html">Permalink</a>
    </p>
  </div>
  
<!-- Comments are turned off for this post. -->




      </div>
    </div>
    <script src="/scripts/responsive.js" type="text/javascript"></script>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Meet Graphite&mdash;Mark Crossfield</title>
      <meta name="viewport" content="width=device-width">

      <!-- syntax highlighting CSS -->
      <link rel="stylesheet" href="/css/syntax.css">

      <!-- Custom CSS -->
      <link rel="stylesheet" href="/css/main.css">

      <!-- Responsive CSS -->
      <link rel="stylesheet" href="/css/responsive.css">

      <!-- Google Fonts -->
      <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>
      <link href='http://fonts.googleapis.com/css?family=Raleway:300,400,700' rel='stylesheet' type='text/css'>
      <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-352611-12', 'markcrossfield.co.uk');
      ga('require', 'linkid', 'linkid.js');
      ga('send', 'pageview');

    </script>
    <script type="text/javascript">
      var disqus_developer = 1;
    </script>
  </head>
  <body>
    <div class="site">
      <div class="sidebar" id="sidebar">
        <div class="header">
          <a href="/"><img id="logo" src="/images/logo.png" width="128" height="99"></a>
          <span class="tagline">Developer, engineer, trouble maker</span>
        </div>
        <div class="footer">
          <span id="footer-links">
            <a href="/about/" class="footer-link">About Mark</a> <span class="separator">&bull;</span>
            <a href="https://twitter.com/mrmanc" class="footer-link">@mrmanc</a> <span class="separator">&bull;</span>
            <a href="https://github.com/mrmanc" class="footer-link">GitHub</a>
          </span>
        </div>
        <div class="posts">
          <ul class="posts-list">
            
              <li class="post-link">
                <a class="post-title" href="/2014-05-01-devops-manchester-monitoring-graphite-and-friends.html">
                  <span class="post-date">01 May 2014</span>
                  DevOps Manchester—Graphite and Friends
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-04-07-quality-shell-scripting-static-analysis.html">
                  <span class="post-date">07 Apr 2014</span>
                  Static Analysis of Shell Scripts
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-28-bad-interpreter-use-svn-autoprops-to-stop-committing-windows-line-endings-in-shell-scripts.html">
                  <span class="post-date">28 Mar 2014</span>
                  Bad Interpreter—SVN autoprops save the day
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-27-bash-shell-unit-testing.html">
                  <span class="post-date">27 Mar 2014</span>
                  Test Driven Development in Bash
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-25-bash-dotfiles-bindle.html">
                  <span class="post-date">25 Mar 2014</span>
                  Take your scripts with you
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-17-using-os-x-at-work-behind-a-proxy.html">
                  <span class="post-date">17 Mar 2014</span>
                  Using OS X at work behind a proxy
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-03-16-free-hosting-with-github-pages.html">
                  <span class="post-date">16 Mar 2014</span>
                  Free hosting with Github Pages
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2014-02-16-thats-no-moon-visualising-go-delivery-pipelines-using-d3-js.html">
                  <span class="post-date">16 Feb 2014</span>
                  That’s no moon: Visualising Go Delivery Pipelines Using D3.js
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2013-05-22-saving-the-world-one-dashboard-at-a-time-using-task-scheduler-and-nircmd-and-powercfg.html">
                  <span class="post-date">22 May 2013</span>
                  Saving the world, one dashboard at a time
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2012-06-26-ascii-distribution-histogram-pivot-your-standard-out.html">
                  <span class="post-date">26 Jun 2012</span>
                  Ascii Distribution Histogram—pivot your standard out
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2012-06-25-simply-measure-anything-with-metriclogster.html">
                  <span class="post-date">25 Jun 2012</span>
                  Simply Measure Anything with MetricLogster
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2012-05-10-meet-graphite.html">
                  <span class="post-date">10 May 2012</span>
                  Meet Graphite
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2012-02-15-fast-feedback.html">
                  <span class="post-date">15 Feb 2012</span>
                  Fast Feedback
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2011-07-31-are-your-pairs-rotating-enough-generate-a-pairing-heat-map.html">
                  <span class="post-date">31 Jul 2011</span>
                  Are your pairs rotating enough? Generate a pairing heat map
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2011-07-30-automating-vuze-with-dropbox-in-os-x.html">
                  <span class="post-date">30 Jul 2011</span>
                  Automating Vuze with Dropbox (in OS X)
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/2011-06-05-hello.html">
                  <span class="post-date">05 Jun 2011</span>
                  Hello!
                </a>
              </li>
            
          </ul>
        </div>
        <div class="footer">
          <p>Hosted on <a href="http://pages.github.com/">Github Pages</a> using <a href="http://jekyllrb.com/">Jekyll</a> and <a href="http://the-development.github.io/flex/">Flex</a>
        </div>
      </div>
      <div class="content" id="home">
          <div id="sidebar-button">
    <img src="/images/sidebar-button.png" width="32" height="32">
  </div>
  <div id="post-info">
    
    <div id="info-container">
      <h1 id="title">Meet Graphite</h1>
      <span id="date">10 May 2012</a>
    </div>
  </div>

  <div class="post">
    <p>Last year i was fascinated by a <a href="http://velocityconf.com/velocity2011/public/schedule/detail/17776">presentation</a> <a href="http://www.slideshare.net/mikebrittain/metrics-driven-engineering-at-etsy">[slides]</a> by Etsy about their approach of metrics driven engineering - see their blog post - <a href="http://codeascraft.etsy.com/2011/02/15/measure-anything-measure-everything/">Measure Anything, Measure Everything</a>. They started with some questions: how many of us had access to our production logs (a reassuringly high amount), and how many of us could tell them how many hits our application was getting right now / how many hits it got this time last year.</p>

<p>They outlined how they use <a href="http://graphite.wikidot.com/">Graphite</a> to visualise how their applications are running in their live environment, and how they use <a href="https://github.com/etsy/logster">logster</a> and <a href="https://github.com/etsy/statsd">StatsD</a> to feed information in from a variety of sources such as log files and UDP packets sent by their application. The metrics shown in Graphite are an aggregate view of things like response codes, response time, checkouts and basically any other arbitrary information their engineers find interesting. Their mantra of measure everything stems from the fact that this is valuable data, which can <a href="http://codeascraft.etsy.com/2010/12/08/track-every-release/">quickly indicate issues with deployments</a> (they deploy around 20 times a day) or the environment the application runs in.</p>

<p>The confidence that this gives them allows them to move faster and respond more quickly. So, should they deploy a fresh new build and see the HTTP 5xx status codes jump, or the checkouts suddenly dip, they can respond by reverting ASAP. Having access to this sort of real time data is incredibly powerful (not to mention addictive).</p>

<p>The advice is to make it easy for developers to get metrics into Graphite, and then sit back and see what happens. So the two main feeder technologies you have to work with are:</p>

<ul>
<li><strong>StatsD</strong> - a node.js app which collates metrics from UDP packets and performs some aggregation</li>
<li><strong>Logster</strong> - a Python framework which allows you to adapt or create parsers easily which aggregate information from your log files</li>
</ul>

<h4>Screenshots</h4>

<p>So, I’ll show you some pretty pictures. Graphite is a web application which provides a view on to aggregated data. It provides the ability to build custom charts with the metrics you have pushed in using Logster, StatsD or something else. You can further aggregate data series and use <a href="http://graphite.readthedocs.org/en/1.0/functions.html">other functions</a> to transform the data you are interested in. You can view metrics over arbitrary time periods and drill down to as much granularity as you’ve recorded (most likely the individual server level if you used Logster).</p>

<p><img src="http://graphite.wikidot.com/local--files/screen-shots/graphite_fullscreen_800.png" alt=""></p>

<p>It also has a dashboard builder, albeit slightly lacking - we have built custom dashboards using the simple image api - configuration, functions and metric names are passed by parameter in a simple URL.</p>

<p><img src="http://graphite.wikidot.com/local--files/screen-shots/graphite_cli_800.png" alt=""></p>

<h4>Our progress</h4>

<p>Almost one year on and we have a number of teams in the organisation feeding data into Graphite using logster. We have data coming from browsers, from Apache, from applications through Log4J, from Squid and more. Interest is still growing but we have already seen huge benefits and an improvement to our stability response.</p>

<p><a href="http://markisadeveloper.files.wordpress.com/2012/05/dashboard.png"><img src="http://markisadeveloper.files.wordpress.com/2012/05/dashboard.png" alt=""></a>Dashboards mounted on walls keep us up to date with problems and have become the heartbeat for our applications. When we are deploying we watch for issues closely, and we keep a weather eye on the app all day. Although we’re not quite at the point where we’re controlling our own deployments, our delivery team have taken a lot more responsibility for the application’s stability, which can only be a good thing.</p>

<p>So what sort of things do we log? In the chart below you can see our traffic pattern over a 48 hour period, with a 24 hour offset level in green for comparison. Although this is a fairly static chart it does sometimes alert us to serious stability issues when our traffic has dropped steadily, and once to a DNS misconfiguration which sent a high volume of traffic for another application to ours.</p>

<p><a href="http://markisadeveloper.files.wordpress.com/2012/05/traffic.png"><img src="http://markisadeveloper.files.wordpress.com/2012/05/traffic.png" alt=""></a></p>

<p>More changeable is a chart of error indicators such as log statements above WARN, and HTTP 500 status codes issued to users. This is one of the most telling chart of them all, indicating anything from a faulty external dependency to some sort of scraping activity.</p>

<p><a href="http://markisadeveloper.files.wordpress.com/2012/05/errors.png"><img src="http://markisadeveloper.files.wordpress.com/2012/05/errors.png" alt=""></a></p>

<p>We also show a chart of the median response times for requests, and a measure of the realistic time it takes users to load pages, as reported by browsers using the <a href="http://yahoo.github.com/boomerang/doc/">Boomerang</a> library. As well as reassurring us of the shape of our overall page performance, it allows us to see when our users are impacted by slowdowns caused by database issues, slow external dependencies etc.</p>

<p>From an obscure black box a year ago to a realistic view of our application’s innards today, we’ve come a long way.</p>

<h4>What’s next?</h4>

<p><em><strong>Alerting</strong></em>; since this information is valuable to us we intend to improve our response by hooking up something like <a href="https://github.com/wayfair/Graphite-Tattle">Graphite Tattle</a> or <a href="http://www.nagios.org/">Nagios</a> to provide us with alerts when metrics exceed thresholds. Further, using the <a href="http://graphite.readthedocs.org/en/1.0/functions.html#graphite.render.functions.holtWintersAberration">Holt Winters functions</a> recently introduced in Graphite we intend to make these alerts smart, basing their confidence of an event on previous data.</p>

<p><em><strong>Aggregation</strong></em>; using Logster we have a view of metrics split between application servers, since that is the granularity of our log files. Ideally we would like to record some metrics over multiple servers. This can be done with StatsD, but due to concerns and uncertainty over scalability and redundancy we are considering alternatives.</p>

<p><em><strong>Dashboards</strong></em>; alternative front ends to Graphite are available such as <a href="https://github.com/paperlesspost/graphiti">Graphiti</a>, and we plan to evaluate these to see if they fit our needs better than our custom efforts.</p>

<p><em><strong>Easy creation of metrics</strong></em>; I am about to contribute a generalised Logster parser to the project which will make the creation of useful metrics as easy as adding one line of debug, following a prescribed syntax. This should make it trivial for developers to count interesting events in the application such as exceptions or user activities.</p>

  </div>
  <div class="colophon">
    <p>
      <span id="pub-date">Published on 10 May 2012</span> <span class="separator">&bull;</span> <a href="/2012-05-10-meet-graphite.html">Permalink</a>
    </p>
  </div>
  
<!-- Comments are turned off for this post. -->




      </div>
    </div>
    <script src="/scripts/responsive.js" type="text/javascript"></script>
  </body>
</html>
